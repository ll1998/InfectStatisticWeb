<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE">
    <title>新冠肺炎疫情统计</title>
    <script src="echarts.min.js"></script>
    <script src="china.js"></script>
    <script src="Statistic.js"></script>
    <script src="Select.js"></script>
    <style>#china-map {width:1000px; height: 1000px;margin: auto;}</style>
</head>
<body>
    <!--下拉列表-->
    <select id="select">
        <option value ="2020-01-19">2020-01-19</option>
        <option value ="2020-01-20">2020-01-20</option>
        <option value ="2020-01-21">2020-01-21</option>
        <option value ="2020-01-22">2020-01-22</option>
        <option value ="2020-01-23">2020-01-23</option>
        <option value ="2020-01-24">2020-01-24</option>
        <option value ="2020-01-25">2020-01-25</option>
        <option value ="2020-01-26">2020-01-26</option>
        <option value ="2020-01-27">2020-01-27</option>
        <option value ="2020-01-28">2020-01-28</option>
        <option value ="2020-01-29">2020-01-29</option>
        <option value ="2020-01-30">2020-01-30</option>
        <option value ="2020-01-31">2020-01-31</option>
        <option value ="2020-02-01">2020-02-01</option>
        <option value ="2020-02-02">2020-02-02</option>
    </select>
    <button type="button" id="b" style="color: #fa8072" onclick=func()>确定</button></br>

    <!--标题设置-->
    <h1 align="center"><font color="#374b71" face="等线" size=30>新型冠状肺炎疫情统计</font></h1>
    <h2 id="date" align="center"><font color="grey" face="等线" size=5>数据来源：2020-03-10疫情病例统计</font></h2>

    <div id="china-map"></div>
    <script>
        var myChart = echarts.init(document.getElementById('china-map'));
        var mapName = 'china'

        //初始数据
        var data = [
            {name:"北京",value:101},
            {name:"天津",value:2},
            {name:"河北",value:5},
            {name:"山西",value:5},
            {name:"内蒙古",value:4},
            {name:"辽宁",value:599},
            {name:"吉林",value:1},
            {name:"黑龙江",value:34},
            {name:"上海",value:22},
            {name:"江苏",value:4},
            {name:"浙江",value:23},
            {name:"安徽",value:0},
            {name:"福建",value:0},
            {name:"江西",value:7},
            {name:"山东",value:33},
            {name:"河南",value:3},
            {name:"湖北",value:16995},
            {name:"湖南",value:24},
            {name:"重庆",value:28},
            {name:"四川",value:58},
            {name:"贵州",value:15},
            {name:"云南",value:2},
            {name:"西藏",value:0},
            {name:"陕西",value:17},
            {name:"甘肃",value:34},
            {name:"青海",value:0},
            {name:"宁夏",value:4},
            {name:"新疆",value:0},
            {name:"广东",value:71},
            {name:"广西",value:16},
            {name:"海南",value:3},
            {name:"台湾",value:10}        
        ];
            
        var geoCoordMap = {};

        //悬浮文字
        var toolTipData = [
            
            {name:"北京",value:[{name:"现存确诊",value:101}]},
            {name:"天津",value:[{name:"现存确诊",value:2}]},
            {name:"河北",value:[{name:"现存确诊",value:5}]},
            {name:"山西",value:[{name:"现存确诊",value:5}]},
            {name:"内蒙古",value:[{name:"现存确诊",value:4}]},
            {name:"辽宁",value:[{name:"现存确诊",value:13}]},
            {name:"吉林",value:[{name:"现存确诊",value:1}]},
            {name:"黑龙江",value:[{name:"现存确诊",value:34}]},
            {name:"上海",value:[{name:"现存确诊",value:22}]},
            {name:"江苏",value:[{name:"现存确诊",value:4}]},
            {name:"浙江",value:[{name:"现存确诊",value:23}]},
            {name:"安徽",value:[{name:"现存确诊",value:0}]},
            {name:"福建",value:[{name:"现存确诊",value:0}]},
            {name:"江西",value:[{name:"现存确诊",value:7}]},
            {name:"山东",value:[{name:"现存确诊",value:33}]},
            {name:"河南",value:[{name:"现存确诊",value:3}]},
            {name:"湖北",value:[{name:"现存确诊",value:16995}]},
            {name:"湖南",value:[{name:"现存确诊",value:24}]},
            {name:"重庆",value:[{name:"现存确诊",value:28}]},
            {name:"四川",value:[{name:"现存确诊",value:58}]},
            {name:"贵州",value:[{name:"现存确诊",value:15}]},
            {name:"云南",value:[{name:"现存确诊",value:2}]},
            {name:"西藏",value:[{name:"现存确诊",value:0}]},
            {name:"陕西",value:[{name:"现存确诊",value:17}]},
            {name:"甘肃",value:[{name:"现存确诊",value:34}]},
            {name:"青海",value:[{name:"现存确诊",value:0}]},
            {name:"宁夏",value:[{name:"现存确诊",value:4}]},
            {name:"新疆",value:[{name:"现存确诊",value:0}]},
            {name:"广东",value:[{name:"现存确诊",value:71}]},
            {name:"广西",value:[{name:"现存确诊",value:16}]},
            {name:"海南",value:[{name:"现存确诊",value:3}]},
            {name:"台湾",value:[{name:"现存确诊",value:10}]}  
        ];

        /*获取地图数据*/
        myChart.showLoading();
        var mapFeatures = echarts.getMap(mapName).geoJson.features;
        myChart.hideLoading();
        mapFeatures.forEach(function(v) {
            // 地区名称
            var name = v.properties.name;
            // 地区经纬度
            geoCoordMap[name] = v.properties.cp;

        });

        console.log(data)
        console.log(toolTipData)
        var max = 480,
            min = 9; // todo 
        var maxSize4Pin = 100,
            minSize4Pin = 20;
        var convertData = function(data) {
            var res = [];
            for (var i = 0; i < data.length; i++) {
                var geoCoord = geoCoordMap[data[i].name];
                if (geoCoord) {
                    res.push({
                        name: data[i].name,
                        value: geoCoord.concat(data[i].value),
                    });
                }
            }
            return res;
        };

        option = {
           /* title: {
                text: name_title,
                subtext: subname,
                x: 'center',
                textStyle: {
                    color: nameColor,
                    fontFamily: name_fontFamily,
                    fontSize: name_fontSize
                },
                subtextStyle:{
                    fontSize:subname_fontSize,
                    fontFamily:name_fontFamily
                }
            },*/
            tooltip: {
                trigger: 'item',
                formatter: function(params) {
                    if (typeof(params.value)[2] == "undefined") {
                        var toolTiphtml = ''
                        for(var i = 0;i<toolTipData.length;i++){
                            if(params.name==toolTipData[i].name){
                                toolTiphtml += toolTipData[i].name+':<br>'
                                for(var j = 0;j<toolTipData[i].value.length;j++){
                                    toolTiphtml+=toolTipData[i].value[j].name+':'+toolTipData[i].value[j].value+"<br>"
                                }
                            }
                        }
                        console.log(toolTiphtml)
                        // console.log(convertData(data))
                        return toolTiphtml;
                    } else {
                        var toolTiphtml = ''
                        for(var i = 0;i<toolTipData.length;i++){
                            if(params.name==toolTipData[i].name){
                                toolTiphtml += toolTipData[i].name+':<br>'
                                for(var j = 0;j<toolTipData[i].value.length;j++){
                                    toolTiphtml+=toolTipData[i].value[j].name+':'+toolTipData[i].value[j].value+"<br>"
                                }
                            }
                        }
                        console.log(toolTiphtml)
                        // console.log(convertData(data))
                        return toolTiphtml;
                    }
                }
            },
            visualMap:/* {
                show: true,
                min: 0,
                max: 120,
                left: 'left',
                top: 'bottom',
                text: ['高', '低'], // 文本，默认为数值文本
                calculable: true,
                seriesIndex: [1],
                inRange: {
                    // color: ['#3B5077', '#031525'] // 蓝黑
                    // color: ['#ffc0cb', '#800080'] // 红紫
                    // color: ['#3C3B3F', '#605C3C'] // 黑绿
                    // color: ['#0f0c29', '#302b63', '#24243e'] // 黑紫黑
                    // color: ['#23074d', '#cc5333'] // 紫红
                    //color: ['#00467F', '#A5CC82'] // 蓝绿
                    // color: ['#1488CC', '#2B32B2'] // 浅蓝
                    // color: ['#00467F', '#A5CC82'] // 蓝绿
                    // color: ['#00467F', '#A5CC82'] // 蓝绿
                    // color: ['#00467F', '#A5CC82'] // 蓝绿
                // color: ['#00467F', '#A5CC82'] // 蓝绿
                    color: ['#FFFFFF', '#FF0000'] 

                },
                
            

            },*/
            {//颜色的设置  dataRange
                    x: 'left',
                    y: 'center',    
                    splitList: [
                        {start: 1000,color:'#880000'},
                        {start: 499, end: 1000,color:'AA0000',borderColor:'black'},
                        {start: 100, end: 499,color:'#FF3333'},
                        {start: 10, end: 99,color:'#FF8888'},
                        {start: 1, end: 9,color:'#FFCCCC'},
                        {start: 0, end: 0 , color: 'white'},
                    // {end: 0}
                    ],
                    text:['高','低'],// 文本，默认为数值文本
                    
                
                    
            },
                
        
            /*工具按钮组*/
            // toolbox: {
            //     show: true,
            //     orient: 'vertical',
            //     left: 'right',
            //     top: 'center',
            //     feature: {
            //         dataView: {
            //             readOnly: false
            //         },
            //         restore: {},
            //         saveAsImage: {}
            //     }
            // },
            geo: {
                show: true,
                map: mapName,
                label: {
                    normal: {
                        show: false
                    },
                    emphasis: {
                        show: false,
                    }
                },
                roam: true,
                itemStyle: {
                    normal: {
                        areaColor: '#031525',
                        borderColor: '#3B5077',
                    },
                    emphasis: {//高亮颜色设置
                        areaColor: '#FFFF00',
                    }
                }
            },
            series: [{
                    name: '散点',
                    type: 'scatter',
                    coordinateSystem: 'geo',
                    data: convertData(data),
                    //设置圆点的大小随数值变化
                /* symbolSize: function(val) {
                        //return val[2] / 10;
                        if(val[2]<120)
                            return val[2]/10;
                        else 
                            return 20;
                    },*/
                    label: {
                        normal: {
                            formatter: '{b}',
                            position: 'right',
                            show: true
                        },
                        emphasis: {
                            show: true
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: '#05C3F9'
                        //color:'#000000'
                        }
                    }
                },
                {
                    type: 'map',
                    map: mapName,
                    geoIndex: 0,
                    aspectScale: 0.75, //长宽比
                    showLegendSymbol: false, // 存在legend时显示
                    label: {
                        normal: {
                            show: true
                        },
                        emphasis: {
                            show: false,
                            textStyle: {
                                color: '#fff'
                            }
                        }
                    },
                    roam: true,
                    itemStyle: {
                        normal: {
                            areaColor: '#031525',
                            borderColor: '#3B5077',
                        },
                        emphasis: {
                            areaColor: '#2B91B7'
                        }
                    },
                    animation: false,
                    data: data
                },
            /* {
                    name: '点',
                    type: 'scatter',
                    coordinateSystem: 'geo',
                    symbol: 'pin', //气泡
                    symbolSize: function(val) {
                        var a = (maxSize4Pin - minSize4Pin) / (max - min);
                        var b = minSize4Pin - a * min;
                        b = maxSize4Pin - a * max;
                        return a * val[2] + b;
                    },
                    label: {
                        normal: {
                            show: true,
                            textStyle: {
                                color: '#fff',
                                fontSize: 9,
                            }
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: '#F62157', //标志颜色
                        }
                    },
                    zlevel: 6,
                    data: convertData(data),
                },
                {
                    name: 'Top 5',
                    type: 'effectScatter',
                    coordinateSystem: 'geo',
                    data: convertData(data.sort(function(a, b) {
                        return b.value - a.value;
                    }).slice(0, 5)),
                    symbolSize: function(val) {
                        return val[2] / 10;
                    },
                    showEffectOn: 'render',
                    rippleEffect: {
                        brushType: 'stroke'
                    },
                    hoverAnimation: true,
                    label: {
                        normal: {
                            formatter: '{b}',
                            position: 'right',
                            show: true
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: 'yellow',
                            shadowBlur: 10,
                            shadowColor: 'yellow'
                        }
                    },
                    zlevel: 1
                },*/

            ]
        };
        myChart.setOption(option);
        //鼠标悬浮事件
        myChart.on('mouseover', function (params) {
            var dataIndex = params.dataIndex;
            console.log(params);
        });
        //鼠标单击事件
        myChart.on('click', function (params) {
            // console.log(params)
            window.open(encodeURIComponent(params.name)+'.html');
        });
    </script>

</body>
</html>